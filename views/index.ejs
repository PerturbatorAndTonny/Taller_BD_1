<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software de Gestión MVC - Taller</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --primary-dark: #420533; --accent-blue: #14659b; --bg-light: #f8f9fa; }
        body { background-color: var(--bg-light); font-family: 'Segoe UI', sans-serif; }
        .hero-section { height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary-dark), #0f535e); color: white; }
        .hidden { display: none !important; }
        .card-article { border: none; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: 0.3s; }
        .card-article:hover { transform: translateY(-5px); border: 1px solid var(--accent-blue); }
        .search-info-box { background: #fff3cd; border-left: 5px solid var(--accent-blue); border-radius: 8px; }
    </style>
</head>
<body> 
    <div id="home-screen" class="hero-section text-center <%= editArticle ? 'hidden' : '' %>">
        <div>
            <h1 class="display-2 fw-bold mb-3">Investigación Base de Datos</h1>
            <p class="lead mb-4">Gestión de artículos científicos y búsqueda</p>
            <button class="btn btn-light btn-lg px-5 shadow-lg fw-bold" onclick="startApp()">INICIO</button>
        </div>
    </div>

    <div id="main-app" class="container py-5 <%= editArticle ? '' : 'hidden' %>">
        <header class="mb-5 d-flex justify-content-between align-items-center">
            <h2 class="fw-bold">Repositorio de Artículos</h2>
            <button class="btn btn-outline-secondary btn-sm" onclick="location.href='/'">Volver al Inicio</button>
        </header>
 
        <section class="mb-5">
            <input type="text" id="articleSearch" class="form-control form-control-lg shadow-sm" placeholder="Buscar título, autor o palabra clave...">
            <div class="row mt-4" id="articlesGrid">
                <% if (articles && articles.length > 0) { %>
                    <% articles.forEach(function(article) { %>
                        <div class="col-md-4 mb-4 article-card-container">
                            <div class="card h-100 card-article p-3">
                                <span class="badge bg-secondary mb-2" style="width: fit-content;"><%= article.publishYear %></span>
                                <h5 class="fw-bold"><%= article.title %></h5>
                                <p class="text-muted small">Autores: <%= article.autor %></p>
                                <button class="btn btn-outline-primary btn-sm mt-auto" onclick="showArticleDetail('<%= article.title %>', '<%= article.autor %>', '<%= article.publishYear %>', '<%= article.resource %>', '<%= article.abstract %>', '<%= article.keyword %>')">Detalles</button>
                            </div>
                        </div>
                    <% }); %>
                <% } %>
            </div>
        </section>

        <hr class="my-5">

        <section id="crud-section">
            <div class="row g-4">
                <div class="col-lg-4">
                    <div class="card p-4 border-0 shadow-sm">
                        <h5 class="fw-bold mb-3 <%= editArticle ? 'text-warning' : 'text-success' %>">
                            <%= editArticle ? 'Modificar Artículo' : 'Nuevo Artículo' %>
                        </h5>
                        <form action="<%= editArticle ? '/updateArticle' : '/newArticle' %>" method="POST">
                            <input type="text" name="id" class="form-control mb-2" placeholder="ID" value="<%= editArticle ? editArticle.id : '' %>" <%= editArticle ? 'readonly' : '' %> required>
                            <input type="text" name="title" class="form-control mb-2" placeholder="Título" value="<%= editArticle ? editArticle.title : '' %>" required>
                            <input type="text" name="autor" class="form-control mb-2" placeholder="Autor" value="<%= editArticle ? editArticle.autor : '' %>" required>
                            <div class="row g-2 mb-2">
                                <div class="col-5"><input type="number" name="publishYear" class="form-control" placeholder="Año" value="<%= editArticle ? editArticle.publishYear : '' %>" required></div>
                                <div class="col-7"><input type="text" name="resource" class="form-control" placeholder="Fuente" value="<%= editArticle ? editArticle.resource : '' %>" required></div>
                            </div>
                            <textarea name="abstract" class="form-control mb-2" rows="3" placeholder="Resumen" required><%= editArticle ? editArticle.abstract : '' %></textarea>
                            <input type="text" name="keyword" class="form-control mb-3" placeholder="Keywords" value="<%= editArticle ? editArticle.keyword : '' %>" required>
                            
                            <button type="submit" class="btn <%= editArticle ? 'btn-warning' : 'btn-success' %> w-100 fw-bold">
                                <%= editArticle ? 'Actualizar' : 'Guardar' %>
                            </button>
                            <% if (editArticle) { %><a href="/" class="btn btn-link w-100 mt-1 text-muted small">Cancelar</a><% } %>
                        </form>
                    </div>
                </div>

                <div class="col-lg-8">
                    <div class="card p-4 border-0 shadow-sm">
                        <h5 class="fw-bold mb-3">Gestión de Datos</h5>
                        <table class="table table-hover align-middle">
                            <thead class="table-light"><tr><th>ID</th><th>Título</th><th>Acciones</th></tr></thead>
                            <tbody>
                                <% articles.forEach(function(article) { %>
                                    <tr>
                                        <td class="small fw-bold"><%= article.id %></td>
                                        <td class="text-truncate" style="max-width: 250px;"><%= article.title %></td>
                                        <td>
                                            <a href="/edit/<%= article.id %>" class="btn btn-sm btn-info text-white">Editar</a>
                                            <a href="/delete/<%= article.id %>" class="btn btn-sm btn-danger" onclick="return confirm('¿Borrar?')">Borrar</a>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-header bg-primary text-white"><h5 class="modal-title" id="m-title"></h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                <div class="modal-body p-4">
                    <p><strong>Autores:</strong> <span id="m-authors"></span> | <strong>Año:</strong> <span id="m-year"></span></p>
                    <p><strong>Resumen:</strong></p><p id="m-abstract" class="text-muted"></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function startApp() { document.getElementById('home-screen').classList.add('hidden'); document.getElementById('main-app').classList.remove('hidden'); }
        document.getElementById('articleSearch').addEventListener('keyup', function() {
            let filter = this.value.toLowerCase();
            document.querySelectorAll('.article-card-container').forEach(item => {
                item.style.display = item.innerText.toLowerCase().includes(filter) ? '' : 'none';
            });
        });
        function showArticleDetail(title, author, year, source, abstract, keywords) {
            document.getElementById('m-title').innerText = title;
            document.getElementById('m-authors').innerText = author;
            document.getElementById('m-year').innerText = year;
            document.getElementById('m-abstract').innerText = abstract;
            new bootstrap.Modal(document.getElementById('detailModal')).show();
        }
    </script>
</body>
</html>